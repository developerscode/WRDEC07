<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Wine Reviews</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width" />

    <script src="Js/jquery-1.7.2.min.js" type="text/javascript"></script>

    <script src="Js/jquery.mobile-1.2.0-alpha.1.min.js"
        type="text/javascript"></script>
<script type="text/javascript">
    //global variables
    var param1;
    var param2;
    var param3;
    var selectedwine = '';
    var subpar1 = '';
    var subpar2 = '';
    var query_string = '';
    function getdata() {
        var currentNav = $('a.ui-btn-active').text();
        // Do fancy things with it
        //alert(currentNav);
        query_string = currentNav.split(">");

        param1 = query_string[1];
        param2 = query_string[2];
        // alert(query_string[0]);
        //alert(param1);
        //subpar1 = param1.split("&");
        subpar1 = param1.charAt(2) + param1.charAt(3)
        //alert(subpar1);
        subpar2 = param2.charAt(1) + param2.charAt(2) + param2.charAt(3)
        //subpar2 = param2.split("&");
        //  alert(subpar2);
    }
    function SortByRating(x, y) {
        //  alert("reviewstars");
        return ((y.reviewstars == x.reviewstars) ? 0 : ((y.reviewstars > x.reviewstars) ? 1 : -1));
    }
    function SortByPrice(x, y) {
        //  alert("Price-1");
        return y.price - x.price;
    }
    function SortByName(x, y) {
        // alert("Name");
        return ((x.winename == y.winename) ? 0 : ((x.winename > y.winename) ? 1 : -1));

    }
    // When the user views the Track Info page
    $('#BindWines').live('pageshow', function() {
        $('#completeWines li').remove();
        jQuery.getJSON("Js/newwinecurrent.json", function(data) {


            wines = data.rows;
            if (query_string[0] == "Price") {
                alert("Price");
                wines.sort(SortByPrice);
            }
            else if (query_string[0] == "Rating") {
                //alert("reviewstars");
                wines.sort(SortByRating);
            }
            else {
                alert("name");
                wines.sort(SortByName);
            }
            $.each(wines, function(index, wine) {
                if (parseInt(wine.price) >= parseInt(subpar1) && wine.reviewstars >= subpar2) {
                    $('#completeWines').append('<li><span style="font-size:Medium; font-family:Verdana; color:Black;">ID:' + wine.uniqueid + '.</span><Br />' +
                '<span style="font-size:small; font-family:Verdana; color:Black;">Price :' + wine.price + '</span><Br />' +
                '<span style="font-size:small; font-family:Verdana; color:Black;">Review Stars :' + wine.reviewstars + '</span><Br />' +
                '<span style="font-size:small; font-family:Verdana; color:Black;">Review Text:' + wine.reviewtext + '</span><Br />' +
                '</li>');
                }
                $('#completeWines').listview('refresh');
            });
        });

    });

    $('#completeWines li').live('vclick', function() {
        //alert("Works"); // id of clicked li by directly accessing DOMElement property
        selectedwine = $(this).text();
        //alert(selectedwine);

        var query_string2 = selectedwine.split(":");
        var sparam1 = query_string2[1];
        //alert(sparam1);

        var query_string3 = sparam1.split(".");
        var tparam1 = query_string3[0];
        //alert(tparam1);
        $.mobile.changePage("#WineDetailsPage", { transition: "slideup" });
        jQuery.getJSON("Js/newwinecurrent.json", function(data) {

            $('#ClearWinesDetail li').remove();
            wines = data.rows;
            $.each(wines, function(index, wine) {
                //alert(wine.winename + "," + tparam1);


                if (wine.uniqueid == tparam1) {
                    // alert("enter2");
                    $('#ClearWinesDetail').append('<li><span style="color:#336699">ID</span> : ' + wine.uniqueid + '<Br />' +
                '<span style="color:#336699">Type</span> : ' + wine.type + '<Br />' +
                '<span style="color:#336699">Price</span> : ' + wine.price + '<Br />' +
                '<span style="color:#336699">Region </span>: ' + wine.region + '<Br />' +
                '<span style="color:#336699">Review Stars</span> : ' + wine.reviewstars + '<Br />' +
                '<span style="color:#336699">Reviewer</span> : ' + wine.reviewer + '<Br />' +
                '<span style="color:#336699">Potential </span>: ' + wine.potential + '<Br />' +
                '<span style="color:#336699">Review Date </span>: ' + wine.reviewdate + '<Br />' +
                '<span style="color:#336699">Food Pairing</span> : ' + wine.foodpairing + '<Br />' +
                '<span style="color:#336699">Varietal</span> : ' + wine.varietal + '<Br />' +
                '<span style="color:#336699">Producer</span> : ' + wine.producer + '<Br />' +
                '<span style="color:#336699">Review Text</span> : ' + wine.reviewtext + '<Br />' +
                '<span style="color:#336699">Vintages </span>: ' + wine.vintages + '<Br />' +
                '<span style="color:#336699">Alcohol</span> : ' + wine.alcohol + '<Br />' +
                '<span style="color:#336699">Vintage </span>: ' + wine.vintage + '<Br />' +
                '<span style="color:#336699">Year </span>: ' + wine.year + '<Br />' +
                '<span style="color:#336699">Lcbonum </span>: ' + wine.lcbonum + '<Br />' +
                '<span style="color:#336699">Wine Name</span> : ' + wine.name + '<Br />' +
                '</li>');
                    //save in var
                    tracking_data = '<span style="color:#336699">ID</span>: ' + wine.uniqueid + '<Br />' +
                '<span style="color:#336699">Price </span>: ' + wine.price + '<Br />' +
                '<span style="color:#336699">Region </span>: ' + wine.region + '<Br />' +
                '<span style="color:#336699">Review Stars </span>: ' + wine.reviewstars + '<Br />' +
                '<span style="color:#336699">Reviewer </span>: ' + wine.reviewer + '<Br />' +
                '<span style="color:#336699">Potential </span>: ' + wine.potential + '<Br />' +
                '<span style="color:#336699">Review Date</span> : ' + wine.reviewdate + '<Br />' +
                '<span style="color:#336699">Food Pairing </span>: ' + wine.foodpairing + '<Br />' +
                '<span style="color:#336699">Varietal </span>: ' + wine.varietal + '<Br />' +
                '<span style="color:#336699">Producer : ' + wine.producer + '<Br />' +
                '<span style="color:#336699">Review Text : ' + wine.reviewtext + '<Br />' +
                '<span style="color:#336699">Vintages </span>: ' + wine.vintages + '<Br />' +
                '<span style="color:#336699">Alcohol</span> : ' + wine.alcohol + '<Br />' +
                '<span style="color:#336699">Vintage</span> : ' + wine.vintage + '<Br />' +
                '<span style="color:#336699">Year </span>: ' + wine.year + '<Br />' +
                '<span style="color:#336699">Lcbonum</span> : ' + wine.lcbonum + '<Br />' +
                 '<span style="color:#336699">Wine Name</span> : ' + wine.name + '<Br />';
                    //$('#track_id').text(wine.winename);
                    track_id = wine.uniqueid;
                    //alert(track_id);
                    //alert(tracking_data);

                }
                //tracking_data=WinesDetails.val();           

            });
            $('#ClearWinesDetail').listview('refresh');
        });
    });
    //Save the data

    function addtolist() {
        //alert("watch list");
        // Tidy up the UI
        //track_id = $("#track_id").val();
        //alert(track_id);
        //$("#track_id").hide();
        window.localStorage.setItem(track_id, JSON.stringify(tracking_data));
        alert("Succesfully added to watchlist");
    }

    //Wish list
    // When the user views the history page
    var tracks_recorded = '';
    $('#watchlistpage').live('pageshow', function() {

        // Count the number of entries in localStorage and display this information to the user
        tracks_recorded = window.localStorage.length;
        //alert(tracks_recorded);
        $("#tracks_recorded").html("<strong>" + tracks_recorded + "</strong> Wines(s) added");

        // Empty the list of recorded tracks
        $("#history_tracklist").empty();

        // Iterate over all of the recorded tracks, populating the list
        for (i = 0; i < tracks_recorded; i++) {
            $("#history_tracklist").append("<li><a href='#track_info' data-ajax='false'>" + window.localStorage.key(i) + "</a></li>");
        }

        // Tell jQueryMobile to refresh the list
        $("#history_tracklist").listview('refresh');

    });
    // When the user clicks a link to view track info, set/change the track_id attribute on the track_info page.
    $("#history_tracklist li a").live('click', function() {

        $("#track_info").attr("track_id", $(this).text());

    });

    // When the user views the Track Info page
    $('#track_info').live('pageshow', function() {

        // Find the track_id of the workout they are viewing
        var key = $(this).attr("track_id");
        //alert(key);
        // Update the Track Info page header to the track_id
        $("#track_info div[data-role=header] h1").text(key);

        // Get all the GPS data for the specific workout
        var data = window.localStorage.getItem(key);
        //alert(data);
        // Turn the stringified GPS data back into a JS object
        data = JSON.parse(data);

        // Calculate the total distance travelled
        total_km = 0;

        for (i = 0; i < data.length; i++) {

            total_km += data[i];
        }
        // Display total distance and time
        $("#track_info_info").html(total_km);
    });

</script>
    <link rel="stylesheet" href="CSS/jquery.mobile-1.2.0-alpha.1.min.css"
        type="text/css" />
  <!--  <link href="CSS/styles.css" rel="Stylesheet" type="text/css" />-->
</head>
<body>
    <div data-role="page" id="startPage" data-theme="c">
        <div data-role="header" data-theme="b" data-position="inline" id="start_header">
            <!--<a href="index.html" data-theme="a" class="ui-btn-left" rel="external">Cancel</a>-->
            <h1 style="font-size: 14px;">Sort/Filter DEC 07</h1>
            <a href="#BindWines" data-theme="a" class="ui-btn-right" rel="external" onclick="getdata()">Submit</a>
        </div>
        <div data-role="content">
       <ul data-role="listview" data-theme="d" data-inset='true' data-inline='false'  data-divider-theme="d">
      
       <li>
            <div data-role="navbar" data-theme="b">
            <h1 style="font-size: 14px;">Sort Results By</h1>
                <ul>
                    <li><a href="#" class="ui-btn-active">Rating</a></li>
                    <li><a href="#">Price</a></li>
                    <li><a href="#">Name</a></li>                    
                </ul>
            </div>
            </li>
         </ul>
        
        <ul data-role="listview" data-theme="d" data-inset='true' data-inline='false'  data-divider-theme="d">
       <li><h1 style="font-size: 14px;">Filter Results By</h1></li>
       <li>
            <div data-role="navbar" data-theme="b">
            Cost
                <ul>                    
                    <li><a href="#" class="ui-btn-active">> $10</a></li>
                    <li><a href="#">> $15</a></li>                    
                    <li><a href="#">> $20</a></li>   
                    <li><a href="#">> $25</a></li> 
                </ul>
            </div>
            </li>
            <li>
            <div data-role="navbar" data-theme="b">
            Ratings
                <ul>                    
                    <li><a href="#" class="ui-btn-active">> 3.5</a></li>
                    <li><a href="#">> 4.0</a></li>                    
                    <li><a href="#">> 4.5</a></li>   
                    <li><a href="#">> 5.0</a></li> 
                </ul>
            </div>
            </li>
         </ul> 
        </div>
        <!-- /navbar -->
      	<label><a href="#" id="start_link" data-role="button" data-theme="c"><span id="timer_button">Varietals</span></a></label> 
    </div>
    <!--Second Page-->
    <div data-role="page" id="BindWines" data-theme="c" data-inset='false'>
    <div data-role="header" data-theme="b">
            <a href="index.html" data-theme="a" class="ui-btn-left" rel="external">Back</a>
            <h1 style="font-size: 14px;">Quick Pick</h1>
            <a href="#watchlistpage" data-theme="a" class="ui-btn-right" rel="external">Watch List</a>
        </div>
        <div data-role="content">            
            <h3>
                Wine Details :
            </h3>
            <ul id="completeWines" data-role="listview" data-inset='false' data-inline='false'>
            </ul>   
            <!---footer-->
        </div>
    </div>
    
    <!--Third Page-->
    
    <div data-role="page" id="WineDetailsPage">
        <div data-role="header" data-theme="b" data-position="inline">
            <a href="#BindWines" data-theme="a" class="ui-btn-left" rel="external">Back</a>
            <h1 style="font-size: 14px;">Details</h1>
                <a href="#watchlistpage" data-theme="a" class="ui-btn-right" rel="external">Watch List</a>
        </div>
        <div data-role="content">
            <form method="get" name="ad">
            <a href="#" type="button" data-theme="a" onclick="addtolist(); return false" id="btnaddwatch"
                class="ui-btn-right" rel="external">Add to watch List</a>
            <h3>
                Wine Details :
            </h3>
            <ul id="ClearWinesDetail" data-role="listview" data-theme="c" data-inset='true' data-inline='false'
                data-divider-theme="d">
            </ul>
            <div id="track_id">
            </div>
            
            </form>
            <div data-role="footer" data-theme="b" data-position="fixed" data-iconpos="top">
                <h4>
                </h4>
            </div>
            <!---footer-->
        </div>
        </div>     
     <!--fourth Page-->
     <div data-role="page" id="watchlistpage">
        <div data-role="header" data-theme="b" data-position="inline">
            <a href="#BindWines" data-theme="a" onclick="back(); return false" id="back" class="ui-btn-left"
                rel="external">Back</a>
            <h1 style="font-size: 14px;">
                Watch List</h1>
        </div>
        <div data-role="content" style="padding: 1%">
            <p id="tracks_recorded">
            </p>
            <ul data-role="listview" id="history_tracklist">
            </ul>
            <div data-role="footer" data-theme="b" data-position="fixed" data-iconpos="top">
                <h4>
                </h4>
            </div>
            <!---footer -->
        </div>
    </div>
    <div data-role="page" id="track_info">
        <div data-role="header" data-theme="b">
            <a href="#watchlistpage" data-theme="a" id="A1" class="ui-btn-left"
                rel="external">Back</a>
            <h1>Wine Details</h1>
        </div>
        <div data-role="content">
            <p id="track_info_info">
            </p>
        </div>
    </div>
</body>
</html>
